"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "_sc_server_node_modules_langchain_dist_chains_combine_docs_chain_js";
exports.ids = ["_sc_server_node_modules_langchain_dist_chains_combine_docs_chain_js"];
exports.modules = {

/***/ "(sc_server)/./node_modules/langchain/dist/chains/combine_docs_chain.js":
/*!******************************************************************!*\
  !*** ./node_modules/langchain/dist/chains/combine_docs_chain.js ***!
  \******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MapReduceDocumentsChain: () => (/* binding */ MapReduceDocumentsChain),\n/* harmony export */   RefineDocumentsChain: () => (/* binding */ RefineDocumentsChain),\n/* harmony export */   StuffDocumentsChain: () => (/* binding */ StuffDocumentsChain)\n/* harmony export */ });\n/* harmony import */ var _base_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./base.js */ \"(sc_server)/./node_modules/langchain/dist/chains/base.js\");\n/* harmony import */ var _llm_chain_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./llm_chain.js */ \"(sc_server)/./node_modules/langchain/dist/chains/llm_chain.js\");\n/* harmony import */ var _prompts_prompt_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../prompts/prompt.js */ \"(sc_server)/./node_modules/langchain/dist/prompts/prompt.js\");\n\n\n\n/**\n * Chain that combines documents by stuffing into context.\n * @augments BaseChain\n * @augments StuffDocumentsChainInput\n */ class StuffDocumentsChain extends _base_js__WEBPACK_IMPORTED_MODULE_0__.BaseChain {\n    get inputKeys() {\n        return [\n            this.inputKey,\n            ...this.llmChain.inputKeys\n        ].filter((key)=>key !== this.documentVariableName);\n    }\n    get outputKeys() {\n        return this.llmChain.outputKeys;\n    }\n    constructor(fields){\n        super(fields);\n        Object.defineProperty(this, \"llmChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"inputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"input_documents\"\n        });\n        Object.defineProperty(this, \"documentVariableName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"context\"\n        });\n        this.llmChain = fields.llmChain;\n        this.documentVariableName = fields.documentVariableName ?? this.documentVariableName;\n        this.inputKey = fields.inputKey ?? this.inputKey;\n    }\n    /** @ignore */ _prepInputs(values) {\n        if (!(this.inputKey in values)) {\n            throw new Error(`Document key ${this.inputKey} not found.`);\n        }\n        const { [this.inputKey]: docs , ...rest } = values;\n        const texts = docs.map(({ pageContent  })=>pageContent);\n        const text = texts.join(\"\\n\\n\");\n        return {\n            ...rest,\n            [this.documentVariableName]: text\n        };\n    }\n    /** @ignore */ async _call(values, runManager) {\n        const result = await this.llmChain.call(this._prepInputs(values), runManager?.getChild(\"combine_documents\"));\n        return result;\n    }\n    _chainType() {\n        return \"stuff_documents_chain\";\n    }\n    static async deserialize(data) {\n        if (!data.llm_chain) {\n            throw new Error(\"Missing llm_chain\");\n        }\n        return new StuffDocumentsChain({\n            llmChain: await _llm_chain_js__WEBPACK_IMPORTED_MODULE_1__.LLMChain.deserialize(data.llm_chain)\n        });\n    }\n    serialize() {\n        return {\n            _type: this._chainType(),\n            llm_chain: this.llmChain.serialize()\n        };\n    }\n}\n/**\n * Combine documents by mapping a chain over them, then combining results.\n * @augments BaseChain\n * @augments StuffDocumentsChainInput\n */ class MapReduceDocumentsChain extends _base_js__WEBPACK_IMPORTED_MODULE_0__.BaseChain {\n    get inputKeys() {\n        return [\n            this.inputKey,\n            ...this.combineDocumentChain.inputKeys\n        ];\n    }\n    get outputKeys() {\n        return this.combineDocumentChain.outputKeys;\n    }\n    constructor(fields){\n        super(fields);\n        Object.defineProperty(this, \"llmChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"inputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"input_documents\"\n        });\n        Object.defineProperty(this, \"documentVariableName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"context\"\n        });\n        Object.defineProperty(this, \"returnIntermediateSteps\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"maxTokens\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 3000\n        });\n        Object.defineProperty(this, \"maxIterations\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 10\n        });\n        Object.defineProperty(this, \"ensureMapStep\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"combineDocumentChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.llmChain = fields.llmChain;\n        this.combineDocumentChain = fields.combineDocumentChain;\n        this.documentVariableName = fields.documentVariableName ?? this.documentVariableName;\n        this.ensureMapStep = fields.ensureMapStep ?? this.ensureMapStep;\n        this.inputKey = fields.inputKey ?? this.inputKey;\n        this.maxTokens = fields.maxTokens ?? this.maxTokens;\n        this.maxIterations = fields.maxIterations ?? this.maxIterations;\n        this.returnIntermediateSteps = fields.returnIntermediateSteps ?? false;\n    }\n    /** @ignore */ async _call(values, runManager) {\n        if (!(this.inputKey in values)) {\n            throw new Error(`Document key ${this.inputKey} not found.`);\n        }\n        const { [this.inputKey]: docs , ...rest } = values;\n        let currentDocs = docs;\n        let intermediateSteps = [];\n        // For each iteration, we'll use the `llmChain` to get a new result\n        for(let i = 0; i < this.maxIterations; i += 1){\n            const inputs = currentDocs.map((d)=>({\n                    [this.documentVariableName]: d.pageContent,\n                    ...rest\n                }));\n            const canSkipMapStep = i !== 0 || !this.ensureMapStep;\n            if (canSkipMapStep) {\n                // Calculate the total tokens required in the input\n                const formatted = await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({\n                    [this.combineDocumentChain.inputKey]: currentDocs,\n                    ...rest\n                }));\n                const length = await this.combineDocumentChain.llmChain.llm.getNumTokens(formatted);\n                const withinTokenLimit = length < this.maxTokens;\n                // If we can skip the map step, and we're within the token limit, we don't\n                // need to run the map step, so just break out of the loop.\n                if (withinTokenLimit) {\n                    break;\n                }\n            }\n            const results = await this.llmChain.apply(inputs, // If we have a runManager, then we need to create a child for each input\n            // so that we can track the progress of each input.\n            runManager ? Array.from({\n                length: inputs.length\n            }, (_, i)=>runManager.getChild(`map_${i + 1}`)) : undefined);\n            const { outputKey  } = this.llmChain;\n            // If the flag is set, then concat that to the intermediate steps\n            if (this.returnIntermediateSteps) {\n                intermediateSteps = intermediateSteps.concat(results.map((r)=>r[outputKey]));\n            }\n            currentDocs = results.map((r)=>({\n                    pageContent: r[outputKey],\n                    metadata: {}\n                }));\n        }\n        // Now, with the final result of all the inputs from the `llmChain`, we can\n        // run the `combineDocumentChain` over them.\n        const newInputs = {\n            [this.combineDocumentChain.inputKey]: currentDocs,\n            ...rest\n        };\n        const result = await this.combineDocumentChain.call(newInputs, runManager?.getChild(\"combine_documents\"));\n        // Return the intermediate steps results if the flag is set\n        if (this.returnIntermediateSteps) {\n            return {\n                ...result,\n                intermediateSteps\n            };\n        }\n        return result;\n    }\n    _chainType() {\n        return \"map_reduce_documents_chain\";\n    }\n    static async deserialize(data) {\n        if (!data.llm_chain) {\n            throw new Error(\"Missing llm_chain\");\n        }\n        if (!data.combine_document_chain) {\n            throw new Error(\"Missing combine_document_chain\");\n        }\n        return new MapReduceDocumentsChain({\n            llmChain: await _llm_chain_js__WEBPACK_IMPORTED_MODULE_1__.LLMChain.deserialize(data.llm_chain),\n            combineDocumentChain: await StuffDocumentsChain.deserialize(data.combine_document_chain)\n        });\n    }\n    serialize() {\n        return {\n            _type: this._chainType(),\n            llm_chain: this.llmChain.serialize(),\n            combine_document_chain: this.combineDocumentChain.serialize()\n        };\n    }\n}\n/**\n * Combine documents by doing a first pass and then refining on more documents.\n * @augments BaseChain\n * @augments RefineDocumentsChainInput\n */ class RefineDocumentsChain extends _base_js__WEBPACK_IMPORTED_MODULE_0__.BaseChain {\n    get defaultDocumentPrompt() {\n        return new _prompts_prompt_js__WEBPACK_IMPORTED_MODULE_2__.PromptTemplate({\n            inputVariables: [\n                \"page_content\"\n            ],\n            template: \"{page_content}\"\n        });\n    }\n    get inputKeys() {\n        return [\n            ...new Set([\n                this.inputKey,\n                ...this.llmChain.inputKeys,\n                ...this.refineLLMChain.inputKeys\n            ])\n        ].filter((key)=>key !== this.documentVariableName && key !== this.initialResponseName);\n    }\n    get outputKeys() {\n        return [\n            this.outputKey\n        ];\n    }\n    constructor(fields){\n        super(fields);\n        Object.defineProperty(this, \"llmChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"inputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"input_documents\"\n        });\n        Object.defineProperty(this, \"outputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"output_text\"\n        });\n        Object.defineProperty(this, \"documentVariableName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"context\"\n        });\n        Object.defineProperty(this, \"initialResponseName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"existing_answer\"\n        });\n        Object.defineProperty(this, \"refineLLMChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"documentPrompt\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: this.defaultDocumentPrompt\n        });\n        this.llmChain = fields.llmChain;\n        this.refineLLMChain = fields.refineLLMChain;\n        this.documentVariableName = fields.documentVariableName ?? this.documentVariableName;\n        this.inputKey = fields.inputKey ?? this.inputKey;\n        this.outputKey = fields.outputKey ?? this.outputKey;\n        this.documentPrompt = fields.documentPrompt ?? this.documentPrompt;\n        this.initialResponseName = fields.initialResponseName ?? this.initialResponseName;\n    }\n    /** @ignore */ async _constructInitialInputs(doc, rest) {\n        const baseInfo = {\n            page_content: doc.pageContent,\n            ...doc.metadata\n        };\n        const documentInfo = {};\n        this.documentPrompt.inputVariables.forEach((value)=>{\n            documentInfo[value] = baseInfo[value];\n        });\n        const baseInputs = {\n            [this.documentVariableName]: await this.documentPrompt.format({\n                ...documentInfo\n            })\n        };\n        const inputs = {\n            ...baseInputs,\n            ...rest\n        };\n        return inputs;\n    }\n    /** @ignore */ async _constructRefineInputs(doc, res) {\n        const baseInfo = {\n            page_content: doc.pageContent,\n            ...doc.metadata\n        };\n        const documentInfo = {};\n        this.documentPrompt.inputVariables.forEach((value)=>{\n            documentInfo[value] = baseInfo[value];\n        });\n        const baseInputs = {\n            [this.documentVariableName]: await this.documentPrompt.format({\n                ...documentInfo\n            })\n        };\n        const inputs = {\n            [this.initialResponseName]: res,\n            ...baseInputs\n        };\n        return inputs;\n    }\n    /** @ignore */ async _call(values, runManager) {\n        if (!(this.inputKey in values)) {\n            throw new Error(`Document key ${this.inputKey} not found.`);\n        }\n        const { [this.inputKey]: docs , ...rest } = values;\n        const currentDocs = docs;\n        const initialInputs = await this._constructInitialInputs(currentDocs[0], rest);\n        let res = await this.llmChain.predict({\n            ...initialInputs\n        }, runManager?.getChild(\"answer\"));\n        const refineSteps = [\n            res\n        ];\n        for(let i = 1; i < currentDocs.length; i += 1){\n            const refineInputs = await this._constructRefineInputs(currentDocs[i], res);\n            const inputs = {\n                ...refineInputs,\n                ...rest\n            };\n            res = await this.refineLLMChain.predict({\n                ...inputs\n            }, runManager?.getChild(\"refine\"));\n            refineSteps.push(res);\n        }\n        return {\n            [this.outputKey]: res\n        };\n    }\n    _chainType() {\n        return \"refine_documents_chain\";\n    }\n    static async deserialize(data) {\n        const SerializedLLMChain = data.llm_chain;\n        if (!SerializedLLMChain) {\n            throw new Error(\"Missing llm_chain\");\n        }\n        const SerializedRefineDocumentChain = data.refine_llm_chain;\n        if (!SerializedRefineDocumentChain) {\n            throw new Error(\"Missing refine_llm_chain\");\n        }\n        return new RefineDocumentsChain({\n            llmChain: await _llm_chain_js__WEBPACK_IMPORTED_MODULE_1__.LLMChain.deserialize(SerializedLLMChain),\n            refineLLMChain: await _llm_chain_js__WEBPACK_IMPORTED_MODULE_1__.LLMChain.deserialize(SerializedRefineDocumentChain)\n        });\n    }\n    serialize() {\n        return {\n            _type: this._chainType(),\n            llm_chain: this.llmChain.serialize(),\n            refine_llm_chain: this.refineLLMChain.serialize()\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNjX3NlcnZlcikvLi9ub2RlX21vZHVsZXMvbGFuZ2NoYWluL2Rpc3QvY2hhaW5zL2NvbWJpbmVfZG9jc19jaGFpbi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBc0M7QUFDSTtBQUNZO0FBQ3REOzs7O0NBSUMsR0FDTSxNQUFNRyw0QkFBNEJILCtDQUFTQTtJQUM5QyxJQUFJSSxZQUFZO1FBQ1osT0FBTztZQUFDLElBQUksQ0FBQ0M7ZUFBYSxJQUFJLENBQUNDLFNBQVNGO1NBQVUsQ0FBQ0csT0FBTyxDQUFDQyxNQUFRQSxRQUFRLElBQUksQ0FBQ0M7SUFDcEY7SUFDQSxJQUFJQyxhQUFhO1FBQ2IsT0FBTyxJQUFJLENBQUNKLFNBQVNJO0lBQ3pCO0lBQ0FDLFlBQVlDLE1BQU0sQ0FBRTtRQUNoQixLQUFLLENBQUNBO1FBQ05DLE9BQU9DLGVBQWUsSUFBSSxFQUFFLFlBQVk7WUFDcENDLFlBQVk7WUFDWkMsY0FBYztZQUNkQyxVQUFVO1lBQ1ZDLE9BQU8sS0FBSztRQUNoQjtRQUNBTCxPQUFPQyxlQUFlLElBQUksRUFBRSxZQUFZO1lBQ3BDQyxZQUFZO1lBQ1pDLGNBQWM7WUFDZEMsVUFBVTtZQUNWQyxPQUFPO1FBQ1g7UUFDQUwsT0FBT0MsZUFBZSxJQUFJLEVBQUUsd0JBQXdCO1lBQ2hEQyxZQUFZO1lBQ1pDLGNBQWM7WUFDZEMsVUFBVTtZQUNWQyxPQUFPO1FBQ1g7UUFDQSxJQUFJLENBQUNaLFdBQVdNLE9BQU9OO1FBQ3ZCLElBQUksQ0FBQ0csdUJBQ0RHLE9BQU9ILHdCQUF3QixJQUFJLENBQUNBO1FBQ3hDLElBQUksQ0FBQ0osV0FBV08sT0FBT1AsWUFBWSxJQUFJLENBQUNBO0lBQzVDO0lBQ0EsWUFBWSxHQUNaYyxZQUFZQyxNQUFNLEVBQUU7UUFDaEIsSUFBSSxDQUFFLEtBQUksQ0FBQ2YsWUFBWWUsTUFBSyxHQUFJO1lBQzVCLE1BQU0sSUFBSUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUNoQixTQUFTLFdBQVcsQ0FBQztRQUM5RDtR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QUNrQyxZQUFZMkQ7UUFDL0M7SUFDSjtJQUNBeEQsWUFBWTtRQUNSLE9BQU87WUFDSEMsT0FBTyxJQUFJLENBQUNMO1lBQ1pHLFdBQVcsSUFBSSxDQUFDL0IsU0FBU2dDO1lBQ3pCeUQsa0JBQWtCLElBQUksQ0FBQ25CLGVBQWV0QztRQUMxQztJQUNKO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tb29kLy4vbm9kZV9tb2R1bGVzL2xhbmdjaGFpbi9kaXN0L2NoYWlucy9jb21iaW5lX2RvY3NfY2hhaW4uanM/Y2M3ZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXNlQ2hhaW4gfSBmcm9tIFwiLi9iYXNlLmpzXCI7XG5pbXBvcnQgeyBMTE1DaGFpbiB9IGZyb20gXCIuL2xsbV9jaGFpbi5qc1wiO1xuaW1wb3J0IHsgUHJvbXB0VGVtcGxhdGUgfSBmcm9tIFwiLi4vcHJvbXB0cy9wcm9tcHQuanNcIjtcbi8qKlxuICogQ2hhaW4gdGhhdCBjb21iaW5lcyBkb2N1bWVudHMgYnkgc3R1ZmZpbmcgaW50byBjb250ZXh0LlxuICogQGF1Z21lbnRzIEJhc2VDaGFpblxuICogQGF1Z21lbnRzIFN0dWZmRG9jdW1lbnRzQ2hhaW5JbnB1dFxuICovXG5leHBvcnQgY2xhc3MgU3R1ZmZEb2N1bWVudHNDaGFpbiBleHRlbmRzIEJhc2VDaGFpbiB7XG4gICAgZ2V0IGlucHV0S2V5cygpIHtcbiAgICAgICAgcmV0dXJuIFt0aGlzLmlucHV0S2V5LCAuLi50aGlzLmxsbUNoYWluLmlucHV0S2V5c10uZmlsdGVyKChrZXkpID0+IGtleSAhPT0gdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZSk7XG4gICAgfVxuICAgIGdldCBvdXRwdXRLZXlzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sbG1DaGFpbi5vdXRwdXRLZXlzO1xuICAgIH1cbiAgICBjb25zdHJ1Y3RvcihmaWVsZHMpIHtcbiAgICAgICAgc3VwZXIoZmllbGRzKTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibGxtQ2hhaW5cIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiaW5wdXRLZXlcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IFwiaW5wdXRfZG9jdW1lbnRzXCJcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImRvY3VtZW50VmFyaWFibGVOYW1lXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiBcImNvbnRleHRcIlxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5sbG1DaGFpbiA9IGZpZWxkcy5sbG1DaGFpbjtcbiAgICAgICAgdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZSA9XG4gICAgICAgICAgICBmaWVsZHMuZG9jdW1lbnRWYXJpYWJsZU5hbWUgPz8gdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZTtcbiAgICAgICAgdGhpcy5pbnB1dEtleSA9IGZpZWxkcy5pbnB1dEtleSA/PyB0aGlzLmlucHV0S2V5O1xuICAgIH1cbiAgICAvKiogQGlnbm9yZSAqL1xuICAgIF9wcmVwSW5wdXRzKHZhbHVlcykge1xuICAgICAgICBpZiAoISh0aGlzLmlucHV0S2V5IGluIHZhbHVlcykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRG9jdW1lbnQga2V5ICR7dGhpcy5pbnB1dEtleX0gbm90IGZvdW5kLmApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgW3RoaXMuaW5wdXRLZXldOiBkb2NzLCAuLi5yZXN0IH0gPSB2YWx1ZXM7XG4gICAgICAgIGNvbnN0IHRleHRzID0gZG9jcy5tYXAoKHsgcGFnZUNvbnRlbnQgfSkgPT4gcGFnZUNvbnRlbnQpO1xuICAgICAgICBjb25zdCB0ZXh0ID0gdGV4dHMuam9pbihcIlxcblxcblwiKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICBbdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZV06IHRleHQsXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKiBAaWdub3JlICovXG4gICAgYXN5bmMgX2NhbGwodmFsdWVzLCBydW5NYW5hZ2VyKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMubGxtQ2hhaW4uY2FsbCh0aGlzLl9wcmVwSW5wdXRzKHZhbHVlcyksIHJ1bk1hbmFnZXI/LmdldENoaWxkKFwiY29tYmluZV9kb2N1bWVudHNcIikpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBfY2hhaW5UeXBlKCkge1xuICAgICAgICByZXR1cm4gXCJzdHVmZl9kb2N1bWVudHNfY2hhaW5cIjtcbiAgICB9XG4gICAgc3RhdGljIGFzeW5jIGRlc2VyaWFsaXplKGRhdGEpIHtcbiAgICAgICAgaWYgKCFkYXRhLmxsbV9jaGFpbikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyBsbG1fY2hhaW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBTdHVmZkRvY3VtZW50c0NoYWluKHtcbiAgICAgICAgICAgIGxsbUNoYWluOiBhd2FpdCBMTE1DaGFpbi5kZXNlcmlhbGl6ZShkYXRhLmxsbV9jaGFpbiksXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzZXJpYWxpemUoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBfdHlwZTogdGhpcy5fY2hhaW5UeXBlKCksXG4gICAgICAgICAgICBsbG1fY2hhaW46IHRoaXMubGxtQ2hhaW4uc2VyaWFsaXplKCksXG4gICAgICAgIH07XG4gICAgfVxufVxuLyoqXG4gKiBDb21iaW5lIGRvY3VtZW50cyBieSBtYXBwaW5nIGEgY2hhaW4gb3ZlciB0aGVtLCB0aGVuIGNvbWJpbmluZyByZXN1bHRzLlxuICogQGF1Z21lbnRzIEJhc2VDaGFpblxuICogQGF1Z21lbnRzIFN0dWZmRG9jdW1lbnRzQ2hhaW5JbnB1dFxuICovXG5leHBvcnQgY2xhc3MgTWFwUmVkdWNlRG9jdW1lbnRzQ2hhaW4gZXh0ZW5kcyBCYXNlQ2hhaW4ge1xuICAgIGdldCBpbnB1dEtleXMoKSB7XG4gICAgICAgIHJldHVybiBbdGhpcy5pbnB1dEtleSwgLi4udGhpcy5jb21iaW5lRG9jdW1lbnRDaGFpbi5pbnB1dEtleXNdO1xuICAgIH1cbiAgICBnZXQgb3V0cHV0S2V5cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tYmluZURvY3VtZW50Q2hhaW4ub3V0cHV0S2V5cztcbiAgICB9XG4gICAgY29uc3RydWN0b3IoZmllbGRzKSB7XG4gICAgICAgIHN1cGVyKGZpZWxkcyk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImxsbUNoYWluXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImlucHV0S2V5XCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiBcImlucHV0X2RvY3VtZW50c1wiXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJkb2N1bWVudFZhcmlhYmxlTmFtZVwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogXCJjb250ZXh0XCJcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJldHVybkludGVybWVkaWF0ZVN0ZXBzXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibWF4VG9rZW5zXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiAzMDAwXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJtYXhJdGVyYXRpb25zXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiAxMFxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiZW5zdXJlTWFwU3RlcFwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImNvbWJpbmVEb2N1bWVudENoYWluXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubGxtQ2hhaW4gPSBmaWVsZHMubGxtQ2hhaW47XG4gICAgICAgIHRoaXMuY29tYmluZURvY3VtZW50Q2hhaW4gPSBmaWVsZHMuY29tYmluZURvY3VtZW50Q2hhaW47XG4gICAgICAgIHRoaXMuZG9jdW1lbnRWYXJpYWJsZU5hbWUgPVxuICAgICAgICAgICAgZmllbGRzLmRvY3VtZW50VmFyaWFibGVOYW1lID8/IHRoaXMuZG9jdW1lbnRWYXJpYWJsZU5hbWU7XG4gICAgICAgIHRoaXMuZW5zdXJlTWFwU3RlcCA9IGZpZWxkcy5lbnN1cmVNYXBTdGVwID8/IHRoaXMuZW5zdXJlTWFwU3RlcDtcbiAgICAgICAgdGhpcy5pbnB1dEtleSA9IGZpZWxkcy5pbnB1dEtleSA/PyB0aGlzLmlucHV0S2V5O1xuICAgICAgICB0aGlzLm1heFRva2VucyA9IGZpZWxkcy5tYXhUb2tlbnMgPz8gdGhpcy5tYXhUb2tlbnM7XG4gICAgICAgIHRoaXMubWF4SXRlcmF0aW9ucyA9IGZpZWxkcy5tYXhJdGVyYXRpb25zID8/IHRoaXMubWF4SXRlcmF0aW9ucztcbiAgICAgICAgdGhpcy5yZXR1cm5JbnRlcm1lZGlhdGVTdGVwcyA9IGZpZWxkcy5yZXR1cm5JbnRlcm1lZGlhdGVTdGVwcyA/PyBmYWxzZTtcbiAgICB9XG4gICAgLyoqIEBpZ25vcmUgKi9cbiAgICBhc3luYyBfY2FsbCh2YWx1ZXMsIHJ1bk1hbmFnZXIpIHtcbiAgICAgICAgaWYgKCEodGhpcy5pbnB1dEtleSBpbiB2YWx1ZXMpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYERvY3VtZW50IGtleSAke3RoaXMuaW5wdXRLZXl9IG5vdCBmb3VuZC5gKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IFt0aGlzLmlucHV0S2V5XTogZG9jcywgLi4ucmVzdCB9ID0gdmFsdWVzO1xuICAgICAgICBsZXQgY3VycmVudERvY3MgPSBkb2NzO1xuICAgICAgICBsZXQgaW50ZXJtZWRpYXRlU3RlcHMgPSBbXTtcbiAgICAgICAgLy8gRm9yIGVhY2ggaXRlcmF0aW9uLCB3ZSdsbCB1c2UgdGhlIGBsbG1DaGFpbmAgdG8gZ2V0IGEgbmV3IHJlc3VsdFxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubWF4SXRlcmF0aW9uczsgaSArPSAxKSB7XG4gICAgICAgICAgICBjb25zdCBpbnB1dHMgPSBjdXJyZW50RG9jcy5tYXAoKGQpID0+ICh7XG4gICAgICAgICAgICAgICAgW3RoaXMuZG9jdW1lbnRWYXJpYWJsZU5hbWVdOiBkLnBhZ2VDb250ZW50LFxuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBjb25zdCBjYW5Ta2lwTWFwU3RlcCA9IGkgIT09IDAgfHwgIXRoaXMuZW5zdXJlTWFwU3RlcDtcbiAgICAgICAgICAgIGlmIChjYW5Ta2lwTWFwU3RlcCkge1xuICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgdG90YWwgdG9rZW5zIHJlcXVpcmVkIGluIHRoZSBpbnB1dFxuICAgICAgICAgICAgICAgIGNvbnN0IGZvcm1hdHRlZCA9IGF3YWl0IHRoaXMuY29tYmluZURvY3VtZW50Q2hhaW4ubGxtQ2hhaW4ucHJvbXB0LmZvcm1hdCh0aGlzLmNvbWJpbmVEb2N1bWVudENoYWluLl9wcmVwSW5wdXRzKHtcbiAgICAgICAgICAgICAgICAgICAgW3RoaXMuY29tYmluZURvY3VtZW50Q2hhaW4uaW5wdXRLZXldOiBjdXJyZW50RG9jcyxcbiAgICAgICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgY29uc3QgbGVuZ3RoID0gYXdhaXQgdGhpcy5jb21iaW5lRG9jdW1lbnRDaGFpbi5sbG1DaGFpbi5sbG0uZ2V0TnVtVG9rZW5zKGZvcm1hdHRlZCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgd2l0aGluVG9rZW5MaW1pdCA9IGxlbmd0aCA8IHRoaXMubWF4VG9rZW5zO1xuICAgICAgICAgICAgICAgIC8vIElmIHdlIGNhbiBza2lwIHRoZSBtYXAgc3RlcCwgYW5kIHdlJ3JlIHdpdGhpbiB0aGUgdG9rZW4gbGltaXQsIHdlIGRvbid0XG4gICAgICAgICAgICAgICAgLy8gbmVlZCB0byBydW4gdGhlIG1hcCBzdGVwLCBzbyBqdXN0IGJyZWFrIG91dCBvZiB0aGUgbG9vcC5cbiAgICAgICAgICAgICAgICBpZiAod2l0aGluVG9rZW5MaW1pdCkge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgdGhpcy5sbG1DaGFpbi5hcHBseShpbnB1dHMsIFxuICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIHJ1bk1hbmFnZXIsIHRoZW4gd2UgbmVlZCB0byBjcmVhdGUgYSBjaGlsZCBmb3IgZWFjaCBpbnB1dFxuICAgICAgICAgICAgLy8gc28gdGhhdCB3ZSBjYW4gdHJhY2sgdGhlIHByb2dyZXNzIG9mIGVhY2ggaW5wdXQuXG4gICAgICAgICAgICBydW5NYW5hZ2VyXG4gICAgICAgICAgICAgICAgPyBBcnJheS5mcm9tKHsgbGVuZ3RoOiBpbnB1dHMubGVuZ3RoIH0sIChfLCBpKSA9PiBydW5NYW5hZ2VyLmdldENoaWxkKGBtYXBfJHtpICsgMX1gKSlcbiAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZCk7XG4gICAgICAgICAgICBjb25zdCB7IG91dHB1dEtleSB9ID0gdGhpcy5sbG1DaGFpbjtcbiAgICAgICAgICAgIC8vIElmIHRoZSBmbGFnIGlzIHNldCwgdGhlbiBjb25jYXQgdGhhdCB0byB0aGUgaW50ZXJtZWRpYXRlIHN0ZXBzXG4gICAgICAgICAgICBpZiAodGhpcy5yZXR1cm5JbnRlcm1lZGlhdGVTdGVwcykge1xuICAgICAgICAgICAgICAgIGludGVybWVkaWF0ZVN0ZXBzID0gaW50ZXJtZWRpYXRlU3RlcHMuY29uY2F0KHJlc3VsdHMubWFwKChyKSA9PiByW291dHB1dEtleV0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1cnJlbnREb2NzID0gcmVzdWx0cy5tYXAoKHIpID0+ICh7XG4gICAgICAgICAgICAgICAgcGFnZUNvbnRlbnQ6IHJbb3V0cHV0S2V5XSxcbiAgICAgICAgICAgICAgICBtZXRhZGF0YToge30sXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTm93LCB3aXRoIHRoZSBmaW5hbCByZXN1bHQgb2YgYWxsIHRoZSBpbnB1dHMgZnJvbSB0aGUgYGxsbUNoYWluYCwgd2UgY2FuXG4gICAgICAgIC8vIHJ1biB0aGUgYGNvbWJpbmVEb2N1bWVudENoYWluYCBvdmVyIHRoZW0uXG4gICAgICAgIGNvbnN0IG5ld0lucHV0cyA9IHtcbiAgICAgICAgICAgIFt0aGlzLmNvbWJpbmVEb2N1bWVudENoYWluLmlucHV0S2V5XTogY3VycmVudERvY3MsXG4gICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNvbWJpbmVEb2N1bWVudENoYWluLmNhbGwobmV3SW5wdXRzLCBydW5NYW5hZ2VyPy5nZXRDaGlsZChcImNvbWJpbmVfZG9jdW1lbnRzXCIpKTtcbiAgICAgICAgLy8gUmV0dXJuIHRoZSBpbnRlcm1lZGlhdGUgc3RlcHMgcmVzdWx0cyBpZiB0aGUgZmxhZyBpcyBzZXRcbiAgICAgICAgaWYgKHRoaXMucmV0dXJuSW50ZXJtZWRpYXRlU3RlcHMpIHtcbiAgICAgICAgICAgIHJldHVybiB7IC4uLnJlc3VsdCwgaW50ZXJtZWRpYXRlU3RlcHMgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBfY2hhaW5UeXBlKCkge1xuICAgICAgICByZXR1cm4gXCJtYXBfcmVkdWNlX2RvY3VtZW50c19jaGFpblwiO1xuICAgIH1cbiAgICBzdGF0aWMgYXN5bmMgZGVzZXJpYWxpemUoZGF0YSkge1xuICAgICAgICBpZiAoIWRhdGEubGxtX2NoYWluKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIGxsbV9jaGFpblwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRhdGEuY29tYmluZV9kb2N1bWVudF9jaGFpbikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyBjb21iaW5lX2RvY3VtZW50X2NoYWluXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgTWFwUmVkdWNlRG9jdW1lbnRzQ2hhaW4oe1xuICAgICAgICAgICAgbGxtQ2hhaW46IGF3YWl0IExMTUNoYWluLmRlc2VyaWFsaXplKGRhdGEubGxtX2NoYWluKSxcbiAgICAgICAgICAgIGNvbWJpbmVEb2N1bWVudENoYWluOiBhd2FpdCBTdHVmZkRvY3VtZW50c0NoYWluLmRlc2VyaWFsaXplKGRhdGEuY29tYmluZV9kb2N1bWVudF9jaGFpbiksXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzZXJpYWxpemUoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBfdHlwZTogdGhpcy5fY2hhaW5UeXBlKCksXG4gICAgICAgICAgICBsbG1fY2hhaW46IHRoaXMubGxtQ2hhaW4uc2VyaWFsaXplKCksXG4gICAgICAgICAgICBjb21iaW5lX2RvY3VtZW50X2NoYWluOiB0aGlzLmNvbWJpbmVEb2N1bWVudENoYWluLnNlcmlhbGl6ZSgpLFxuICAgICAgICB9O1xuICAgIH1cbn1cbi8qKlxuICogQ29tYmluZSBkb2N1bWVudHMgYnkgZG9pbmcgYSBmaXJzdCBwYXNzIGFuZCB0aGVuIHJlZmluaW5nIG9uIG1vcmUgZG9jdW1lbnRzLlxuICogQGF1Z21lbnRzIEJhc2VDaGFpblxuICogQGF1Z21lbnRzIFJlZmluZURvY3VtZW50c0NoYWluSW5wdXRcbiAqL1xuZXhwb3J0IGNsYXNzIFJlZmluZURvY3VtZW50c0NoYWluIGV4dGVuZHMgQmFzZUNoYWluIHtcbiAgICBnZXQgZGVmYXVsdERvY3VtZW50UHJvbXB0KCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21wdFRlbXBsYXRlKHtcbiAgICAgICAgICAgIGlucHV0VmFyaWFibGVzOiBbXCJwYWdlX2NvbnRlbnRcIl0sXG4gICAgICAgICAgICB0ZW1wbGF0ZTogXCJ7cGFnZV9jb250ZW50fVwiLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0IGlucHV0S2V5cygpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLm5ldyBTZXQoW1xuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRLZXksXG4gICAgICAgICAgICAgICAgLi4udGhpcy5sbG1DaGFpbi5pbnB1dEtleXMsXG4gICAgICAgICAgICAgICAgLi4udGhpcy5yZWZpbmVMTE1DaGFpbi5pbnB1dEtleXMsXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgXS5maWx0ZXIoKGtleSkgPT4ga2V5ICE9PSB0aGlzLmRvY3VtZW50VmFyaWFibGVOYW1lICYmIGtleSAhPT0gdGhpcy5pbml0aWFsUmVzcG9uc2VOYW1lKTtcbiAgICB9XG4gICAgZ2V0IG91dHB1dEtleXMoKSB7XG4gICAgICAgIHJldHVybiBbdGhpcy5vdXRwdXRLZXldO1xuICAgIH1cbiAgICBjb25zdHJ1Y3RvcihmaWVsZHMpIHtcbiAgICAgICAgc3VwZXIoZmllbGRzKTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibGxtQ2hhaW5cIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiaW5wdXRLZXlcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IFwiaW5wdXRfZG9jdW1lbnRzXCJcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm91dHB1dEtleVwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogXCJvdXRwdXRfdGV4dFwiXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJkb2N1bWVudFZhcmlhYmxlTmFtZVwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogXCJjb250ZXh0XCJcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImluaXRpYWxSZXNwb25zZU5hbWVcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IFwiZXhpc3RpbmdfYW5zd2VyXCJcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlZmluZUxMTUNoYWluXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImRvY3VtZW50UHJvbXB0XCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiB0aGlzLmRlZmF1bHREb2N1bWVudFByb21wdFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5sbG1DaGFpbiA9IGZpZWxkcy5sbG1DaGFpbjtcbiAgICAgICAgdGhpcy5yZWZpbmVMTE1DaGFpbiA9IGZpZWxkcy5yZWZpbmVMTE1DaGFpbjtcbiAgICAgICAgdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZSA9XG4gICAgICAgICAgICBmaWVsZHMuZG9jdW1lbnRWYXJpYWJsZU5hbWUgPz8gdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZTtcbiAgICAgICAgdGhpcy5pbnB1dEtleSA9IGZpZWxkcy5pbnB1dEtleSA/PyB0aGlzLmlucHV0S2V5O1xuICAgICAgICB0aGlzLm91dHB1dEtleSA9IGZpZWxkcy5vdXRwdXRLZXkgPz8gdGhpcy5vdXRwdXRLZXk7XG4gICAgICAgIHRoaXMuZG9jdW1lbnRQcm9tcHQgPSBmaWVsZHMuZG9jdW1lbnRQcm9tcHQgPz8gdGhpcy5kb2N1bWVudFByb21wdDtcbiAgICAgICAgdGhpcy5pbml0aWFsUmVzcG9uc2VOYW1lID1cbiAgICAgICAgICAgIGZpZWxkcy5pbml0aWFsUmVzcG9uc2VOYW1lID8/IHRoaXMuaW5pdGlhbFJlc3BvbnNlTmFtZTtcbiAgICB9XG4gICAgLyoqIEBpZ25vcmUgKi9cbiAgICBhc3luYyBfY29uc3RydWN0SW5pdGlhbElucHV0cyhkb2MsIHJlc3QpIHtcbiAgICAgICAgY29uc3QgYmFzZUluZm8gPSB7XG4gICAgICAgICAgICBwYWdlX2NvbnRlbnQ6IGRvYy5wYWdlQ29udGVudCxcbiAgICAgICAgICAgIC4uLmRvYy5tZXRhZGF0YSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZG9jdW1lbnRJbmZvID0ge307XG4gICAgICAgIHRoaXMuZG9jdW1lbnRQcm9tcHQuaW5wdXRWYXJpYWJsZXMuZm9yRWFjaCgodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGRvY3VtZW50SW5mb1t2YWx1ZV0gPSBiYXNlSW5mb1t2YWx1ZV07XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBiYXNlSW5wdXRzID0ge1xuICAgICAgICAgICAgW3RoaXMuZG9jdW1lbnRWYXJpYWJsZU5hbWVdOiBhd2FpdCB0aGlzLmRvY3VtZW50UHJvbXB0LmZvcm1hdCh7XG4gICAgICAgICAgICAgICAgLi4uZG9jdW1lbnRJbmZvLFxuICAgICAgICAgICAgfSksXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGlucHV0cyA9IHsgLi4uYmFzZUlucHV0cywgLi4ucmVzdCB9O1xuICAgICAgICByZXR1cm4gaW5wdXRzO1xuICAgIH1cbiAgICAvKiogQGlnbm9yZSAqL1xuICAgIGFzeW5jIF9jb25zdHJ1Y3RSZWZpbmVJbnB1dHMoZG9jLCByZXMpIHtcbiAgICAgICAgY29uc3QgYmFzZUluZm8gPSB7XG4gICAgICAgICAgICBwYWdlX2NvbnRlbnQ6IGRvYy5wYWdlQ29udGVudCxcbiAgICAgICAgICAgIC4uLmRvYy5tZXRhZGF0YSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZG9jdW1lbnRJbmZvID0ge307XG4gICAgICAgIHRoaXMuZG9jdW1lbnRQcm9tcHQuaW5wdXRWYXJpYWJsZXMuZm9yRWFjaCgodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGRvY3VtZW50SW5mb1t2YWx1ZV0gPSBiYXNlSW5mb1t2YWx1ZV07XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBiYXNlSW5wdXRzID0ge1xuICAgICAgICAgICAgW3RoaXMuZG9jdW1lbnRWYXJpYWJsZU5hbWVdOiBhd2FpdCB0aGlzLmRvY3VtZW50UHJvbXB0LmZvcm1hdCh7XG4gICAgICAgICAgICAgICAgLi4uZG9jdW1lbnRJbmZvLFxuICAgICAgICAgICAgfSksXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGlucHV0cyA9IHsgW3RoaXMuaW5pdGlhbFJlc3BvbnNlTmFtZV06IHJlcywgLi4uYmFzZUlucHV0cyB9O1xuICAgICAgICByZXR1cm4gaW5wdXRzO1xuICAgIH1cbiAgICAvKiogQGlnbm9yZSAqL1xuICAgIGFzeW5jIF9jYWxsKHZhbHVlcywgcnVuTWFuYWdlcikge1xuICAgICAgICBpZiAoISh0aGlzLmlucHV0S2V5IGluIHZhbHVlcykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRG9jdW1lbnQga2V5ICR7dGhpcy5pbnB1dEtleX0gbm90IGZvdW5kLmApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgW3RoaXMuaW5wdXRLZXldOiBkb2NzLCAuLi5yZXN0IH0gPSB2YWx1ZXM7XG4gICAgICAgIGNvbnN0IGN1cnJlbnREb2NzID0gZG9jcztcbiAgICAgICAgY29uc3QgaW5pdGlhbElucHV0cyA9IGF3YWl0IHRoaXMuX2NvbnN0cnVjdEluaXRpYWxJbnB1dHMoY3VycmVudERvY3NbMF0sIHJlc3QpO1xuICAgICAgICBsZXQgcmVzID0gYXdhaXQgdGhpcy5sbG1DaGFpbi5wcmVkaWN0KHsgLi4uaW5pdGlhbElucHV0cyB9LCBydW5NYW5hZ2VyPy5nZXRDaGlsZChcImFuc3dlclwiKSk7XG4gICAgICAgIGNvbnN0IHJlZmluZVN0ZXBzID0gW3Jlc107XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgY3VycmVudERvY3MubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlZmluZUlucHV0cyA9IGF3YWl0IHRoaXMuX2NvbnN0cnVjdFJlZmluZUlucHV0cyhjdXJyZW50RG9jc1tpXSwgcmVzKTtcbiAgICAgICAgICAgIGNvbnN0IGlucHV0cyA9IHsgLi4ucmVmaW5lSW5wdXRzLCAuLi5yZXN0IH07XG4gICAgICAgICAgICByZXMgPSBhd2FpdCB0aGlzLnJlZmluZUxMTUNoYWluLnByZWRpY3QoeyAuLi5pbnB1dHMgfSwgcnVuTWFuYWdlcj8uZ2V0Q2hpbGQoXCJyZWZpbmVcIikpO1xuICAgICAgICAgICAgcmVmaW5lU3RlcHMucHVzaChyZXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IFt0aGlzLm91dHB1dEtleV06IHJlcyB9O1xuICAgIH1cbiAgICBfY2hhaW5UeXBlKCkge1xuICAgICAgICByZXR1cm4gXCJyZWZpbmVfZG9jdW1lbnRzX2NoYWluXCI7XG4gICAgfVxuICAgIHN0YXRpYyBhc3luYyBkZXNlcmlhbGl6ZShkYXRhKSB7XG4gICAgICAgIGNvbnN0IFNlcmlhbGl6ZWRMTE1DaGFpbiA9IGRhdGEubGxtX2NoYWluO1xuICAgICAgICBpZiAoIVNlcmlhbGl6ZWRMTE1DaGFpbikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyBsbG1fY2hhaW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgU2VyaWFsaXplZFJlZmluZURvY3VtZW50Q2hhaW4gPSBkYXRhLnJlZmluZV9sbG1fY2hhaW47XG4gICAgICAgIGlmICghU2VyaWFsaXplZFJlZmluZURvY3VtZW50Q2hhaW4pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgcmVmaW5lX2xsbV9jaGFpblwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFJlZmluZURvY3VtZW50c0NoYWluKHtcbiAgICAgICAgICAgIGxsbUNoYWluOiBhd2FpdCBMTE1DaGFpbi5kZXNlcmlhbGl6ZShTZXJpYWxpemVkTExNQ2hhaW4pLFxuICAgICAgICAgICAgcmVmaW5lTExNQ2hhaW46IGF3YWl0IExMTUNoYWluLmRlc2VyaWFsaXplKFNlcmlhbGl6ZWRSZWZpbmVEb2N1bWVudENoYWluKSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNlcmlhbGl6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIF90eXBlOiB0aGlzLl9jaGFpblR5cGUoKSxcbiAgICAgICAgICAgIGxsbV9jaGFpbjogdGhpcy5sbG1DaGFpbi5zZXJpYWxpemUoKSxcbiAgICAgICAgICAgIHJlZmluZV9sbG1fY2hhaW46IHRoaXMucmVmaW5lTExNQ2hhaW4uc2VyaWFsaXplKCksXG4gICAgICAgIH07XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbIkJhc2VDaGFpbiIsIkxMTUNoYWluIiwiUHJvbXB0VGVtcGxhdGUiLCJTdHVmZkRvY3VtZW50c0NoYWluIiwiaW5wdXRLZXlzIiwiaW5wdXRLZXkiLCJsbG1DaGFpbiIsImZpbHRlciIsImtleSIsImRvY3VtZW50VmFyaWFibGVOYW1lIiwib3V0cHV0S2V5cyIsImNvbnN0cnVjdG9yIiwiZmllbGRzIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJ2YWx1ZSIsIl9wcmVwSW5wdXRzIiwidmFsdWVzIiwiRXJyb3IiLCJkb2NzIiwicmVzdCIsInRleHRzIiwibWFwIiwicGFnZUNvbnRlbnQiLCJ0ZXh0Iiwiam9pbiIsIl9jYWxsIiwicnVuTWFuYWdlciIsInJlc3VsdCIsImNhbGwiLCJnZXRDaGlsZCIsIl9jaGFpblR5cGUiLCJkZXNlcmlhbGl6ZSIsImRhdGEiLCJsbG1fY2hhaW4iLCJzZXJpYWxpemUiLCJfdHlwZSIsIk1hcFJlZHVjZURvY3VtZW50c0NoYWluIiwiY29tYmluZURvY3VtZW50Q2hhaW4iLCJlbnN1cmVNYXBTdGVwIiwibWF4VG9rZW5zIiwibWF4SXRlcmF0aW9ucyIsInJldHVybkludGVybWVkaWF0ZVN0ZXBzIiwiY3VycmVudERvY3MiLCJpbnRlcm1lZGlhdGVTdGVwcyIsImkiLCJpbnB1dHMiLCJkIiwiY2FuU2tpcE1hcFN0ZXAiLCJmb3JtYXR0ZWQiLCJwcm9tcHQiLCJmb3JtYXQiLCJsZW5ndGgiLCJsbG0iLCJnZXROdW1Ub2tlbnMiLCJ3aXRoaW5Ub2tlbkxpbWl0IiwicmVzdWx0cyIsImFwcGx5IiwiQXJyYXkiLCJmcm9tIiwiXyIsInVuZGVmaW5lZCIsIm91dHB1dEtleSIsImNvbmNhdCIsInIiLCJtZXRhZGF0YSIsIm5ld0lucHV0cyIsImNvbWJpbmVfZG9jdW1lbnRfY2hhaW4iLCJSZWZpbmVEb2N1bWVudHNDaGFpbiIsImRlZmF1bHREb2N1bWVudFByb21wdCIsImlucHV0VmFyaWFibGVzIiwidGVtcGxhdGUiLCJTZXQiLCJyZWZpbmVMTE1DaGFpbiIsImluaXRpYWxSZXNwb25zZU5hbWUiLCJkb2N1bWVudFByb21wdCIsIl9jb25zdHJ1Y3RJbml0aWFsSW5wdXRzIiwiZG9jIiwiYmFzZUluZm8iLCJwYWdlX2NvbnRlbnQiLCJkb2N1bWVudEluZm8iLCJmb3JFYWNoIiwiYmFzZUlucHV0cyIsIl9jb25zdHJ1Y3RSZWZpbmVJbnB1dHMiLCJyZXMiLCJpbml0aWFsSW5wdXRzIiwicHJlZGljdCIsInJlZmluZVN0ZXBzIiwicmVmaW5lSW5wdXRzIiwicHVzaCIsIlNlcmlhbGl6ZWRMTE1DaGFpbiIsIlNlcmlhbGl6ZWRSZWZpbmVEb2N1bWVudENoYWluIiwicmVmaW5lX2xsbV9jaGFpbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(sc_server)/./node_modules/langchain/dist/chains/combine_docs_chain.js\n");

/***/ })

};
;